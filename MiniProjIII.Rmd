---
title: "It’s Not About the Destination but the Journey"
author: "Juliane Donahue Bombosch, Cai Ytsma, Sofia Salcedo"
date: "15 April 2018"
output: #warnings equal = false
  html_document:
    code_folding: hide
    df_print: paged
    css: mystyle.css
---


It is not about the destination but the journey. MacLeish is a valuable asset for the Smith community. It has approximately four miles of maintained trails accessible to visitors. Insuring accessibilty is important for all levels of hiking experience and helps us curate a fun experience for visitors. We aimed to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. We will utilize spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty.

**Bonus** 1. we could look at weather as a variable and take into account how close trails are to wetland patches etc. So that we can rate difficulty based on weather conditions in the interest of people who need to maintain and use those trails.
          2. We could make the map interactive
          3. we could make an interactive based on live weather data and talk
          4. It is really easy to manually add markers for landmarks/ we could probably           write a function to do this
**Side Note** To work with elevation.

counters 1:5000

MAssGIS for 3 foot intervals but start with 1: 2,5000

CONTOURS250K_ARC for thirty foot intervals. it is smaller and yeet

The date is `r format(Sys.Date(), "%B %e, %Y")`
```{r, message = FALSE, warning = FALSE, label = "Set Up", include = FALSE, error = FALSE}
library(tidyverse)
library(dplyr)
library(sf)
library(etl)
library(macleish)
library(leaflet)

devtools::install_github("beanumber/macleish")
```
NEW STUFF
Here is some set up stuff
```{r, message = FALSE, warning = FALSE, label = "Data Manipulating", include = FALSE, error = FALSE}
# find intersection point of trails and elevation
elev <- macleish_layers[["contours_3m"]] %>%
  st_transform(4326) 
trails_inbound <- elev %>%
  st_intersection(macleish_layers[["trails"]])

# OK so this is what I have been working on. THey look funky. What I did. I have inbound MULTIPOINT cast to POINT and then I turn all Points into multipoint and then I can turn it into a graphable lines string. I think in casting it into point We lost labels on each data point. We lost "name" so to solve this I think we can 1. Figure out how not to lose data in trails_point or 2. We can do each trail indicidually which for time reasons is not great. THis is the most important thing to fix. Once we geth this to work everything following will probably run smoothly and we will have it in a format that we can plot. We can also then delete the data frames that I created yesterday. Until we fix this though please do not delete. KK luv ya and see ya later!

trails_pt<- trails_inbound%>%
  group_by(name) %>%
  st_cast( "POINT")

trails_pt2 <- trails_pt %>%
  group_by(grepl("POINT", name)) %>%
  summarize(N = n())

trails_linestring <- trails_pt2 %>%
  st_cast("LINESTRING", name)

trails_linestring<- trails_linestring%>%
  st_cast()

macleish_map <- leaflet() %>%
  addTiles() %>%
  addPolygons(data = trails_linestring, weight = 1)

macleish_map

```
We will need to remerge these
```{r, message = FALSE, warning = FALSE, include = FALSE, error = FALSE}

trails <- macleish_layers[["trails"]] %>%
  group_by(name) %>%
  mutate(length = st_length(geometry)) %>%
  summarize(length_m = sum(length)/1609.34)

#slope
trails_slope <- trails_inbound %>%
  group_by(name) %>%
  mutate(slope = abs(c(NA, diff(ELEV_M))), len = abs(c(NA, diff(SHAPE_LEN)))) %>%
  filter(!is.na(slope)) %>%
  summarize(avg_slope_m = mean(slope/len), tot_change = sum(slope))
            
trails_temp <- trails_pt %>%
  group_by(name) %>%
  mutate(slope = abs(c(NA, diff(ELEV_M))), len = abs(c(NA, diff(SHAPE_LEN)))) %>%
  filter(!is.na(slope))

df_trails <- as.data.frame(trails_slope) %>%
  select(name, avg_slope_m)%>%
  filter(avg_slope_m>0)
df_trails2 <- as.data.frame(trails_temp)%>%
  select(name, slope, len)%>%
  filter(slope>0)

```

```{r, message = FALSE, warning = FALSE, label = "Merge Into another Code", include = FALSE, error = FALSE}
df <- df_trails %>%
  full_join(df_trails2) %>%
  #WE DECIDED TO HAVE DIFFICULTY BY
  mutate(lvl = ((avg_slope_m)*100)) %>%
  arrange(name)
```
The trail difficulty as grouped together by average slope into easy, moderate, and hard. Is this the same as the trail difficulty grouped by trail length?

```{r, results = 'asis', message = FALSE, warning = FALSE, label = "Difficulty Level", error = FALSE}

#trail difficulty classified by average slope
#have all of them, but add another column that says "hard", "easy", or "moderate"
temp <- data.frame(trails_slope) %>%
  filter(name != "Easy Out") %>%
  select(-geometry)

#groupings of the slopes to be shown in the tables below
```
**Table 1.** Trail with the largest elevation change per meter.
```{r}
hard_slope <- temp %>%
  filter(avg_slope_m > 20) %>%
  mutate(Hard_Trails = name, avg_slope_per_m = avg_slope_m, total_elev_change = tot_change) %>%
  select(-name, -avg_slope_m, -tot_change)

writeLines("td, th { padding : 6px } th { background-color : blue ; color : white; border : 1px solid white; } td { color : black ; border : 1px solid blue }", con = "mystyle.css")
hard_table <- hard_slope 
  knitr::kable(hard_table, format = "html") 
```

**Table 2.** Trails with median elevation changes per meter.
```{r}
moderate_slope <- temp %>%
  filter(avg_slope_m < 20, avg_slope_m > 2) %>%
  mutate(Moderate_Trails = name, avg_slope_per_m = avg_slope_m, total_elev_change = tot_change) %>%
  select(-name, -avg_slope_m, -tot_change)

writeLines("td, th { padding : 6px } th { background-color : blue ; color : white; border : 1px solid white; } td { color : black ; border : 1px solid blue }", con = "mystyle.css")
moderate_table <- moderate_slope
knitr::kable(moderate_table, format = "html")
```

**Table 3.** Trail with the smallest elevation changes per meter.
```{r}
easy_slope <- temp %>%
  filter(avg_slope_m < 2) %>%
  mutate(Easy_Trails = name, avg_slope_per_m = avg_slope_m, total_elev_change = tot_change) %>%
  select(-name, -avg_slope_m, -tot_change)

writeLines("td, th { padding : 6px } th { background-color : blue ; color : white; border : 1px solid white; } td { color : black ; border : 1px solid blue }", con = "mystyle.css")
easy_table <- easy_slope 
knitr::kable(easy_table, format = "html")
```

```{r}
#the dataframes of the slope difficulty split up into three different lists
hardsegments <- df %>%
  filter(lvl > 20)

moderatesegments <- df %>%
  filter(lvl < 20, avg_slope_m > 2)

easysegments <- df %>%
  filter(lvl < 2)

```
Trail difficulty by length only. 
Error: both operands of the expression should be in "units" objects

This chunk below should be turned into a table!!!! :) 
```{r echo = FALSE, error=FALSE}
easy_length <- trails %>%
  filter(length_m < 1) #total_length mile is not showing up as something with untis

moderate_length <- trails %>%
  filter(length_m > 1, length_m < 5)

#print(easy)
#print(moderate)
#print(hard)
#print(easysegments)
#print(moderatesegments)
#print(hardsegments)


print(easy_length)
print(moderate_length)
```
Here are map elements and our final map things
```{r, message = FALSE, warning = FALSE, label = "Our Map Code", error = FALSE}
# other variables to be mapped
buildings<- macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["buildings"]])
landmarks<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["landmarks"]])
water<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["streams"]])
meepmeep <- colorFactor(topo.colors(9), trails$name, 
                       palette = c('#2b1344','#730be5','#ff2100','#ff907f','#7ffff4', '#f7e165','#777568','#ff0083','#FFBBFF'))

campsite <- tribble(
  ~point, ~lon, ~lat,
  "Group Campsite", -72.678154, 42.450976, 
  "Remote campsite", -72.679581, 42.458549
)
camp_neu <- campsite %>%
  st_as_sf(coords = c("lon", "lat"))


redmarkercustom <- makeIcon(
  iconUrl = "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|e85141&chf=a,s,ee00FFFF",
  iconWidth = 8, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

campsite_marker <- makeIcon(
  iconUrl = "https://upload.wikimedia.org/wikipedia/commons/9/9a/Legenda_pole_namiotowe.svg",
  iconWidth = 10, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

Our_map <- leaflet(data = c( trails_inbound)) %>%
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>% 
  addPolygons(data = macleish_layers[["boundary"]], weight = 3, color = "#01561d", fillOpacity = 0.5)%>%
  addPolylines(data = macleish_layers[["boundary"]], weight = 3, color = "#185b2e", opacity = 0.65) %>%
  addCircleMarkers(data = st_cast(trails_inbound, "POINT"), color = "purple",radius = 2, popup = ~paste("Trail:",name), group = "Trail Segments") %>%
 addPolylines(data = trails, weight = 2, popup = ~name, color = ~meepmeep(trails$name)) %>%# here is where we would start adding our trails by difficulty average. :)
  addPolylines(data = elev, weight = 0.78, color = "#004400")%>%
  addPolygons(data = buildings, color = "202120", stroke = FALSE, fillOpacity = 1, weight = 1, group = "Buildings and Landmarks")%>%
  addMarkers(data = landmarks, 
             popup = ~Label, group = "Buildings and Landmarks", icon = redmarkercustom )%>%
  addMarkers(data = camp_neu, 
             popup = ~point, group = "Buildings and Landmarks", icon = campsite_marker )%>%
  addLayersControl(
    overlayGroups = c( "Buildings and Landmarks", "Trail Segments"), # we will add polylines for the level of difficulty then we can group by category.
    options = layersControlOptions(collapsed = FALSE))


Our_map


```


#difficulty by length and average elevation for difficulty


PLEASE DO NOT ERASE CHUNK BELOW SO THAT I CAN PICK UP WHERE I LEFT OFF AND KNOW WHAT I AM THINKING! :D
```{r}
#Delete later. what is in this package
names(macleish_layers)
```
THIS IS ALSO PART OF MY THOUGHT PROCESS> PLEASE DO NOT ERASE
```{r}
trails_inbound%>%
  mutate(computed_length = st_length(geometry))%>%
  group_by(desc(name))

#join by geometry. dataframes but need to covert it into an sf otherwise it will not plot. So make into a data frame and join it and then tyrn it back into spacial data
#cast it to a line string. to get trail
#percent slope and then total length of segments.
#short but steep
# do not actually mutate so that we have the same length 
# then look at coloring the segments
# if weather season looking at slope and winter snow. Looking at where do we clear trees. none of the trails get close enough to a stream maybe in the future with new stream. But not yet. Seein if they can build one towards the beaver trail. Would not be an easy trail under in optimal weather.
#seeps on the hillside. east slope. that makes things muddier = harder
 
```


