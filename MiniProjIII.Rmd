---
title: "It’s Not About the Destination but the Journey"
author: "Juliane Donahue Bombosch, Cai Ytsma, Sofia Salcedo"
date: "15 April 2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
---
Side notes to make creative and more interesting to read amoung the many projects.

It is not about the destination but the journey. MacLeish is a valuable asset for the Smith community. It has approximately four miles of maintained trails accessible to visitors. Insuring accessibilty is important for all levels of hiking experience and helps us curate a fun experience for visitors. We aimed to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. We will utilize spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty.

**Bonus** 1. we could look at weather as a variable and take into account how close trails are to wetland patches etc. So that we can rate difficulty based on weather conditions in the interest of people who need to maintain and use those trails.
          2. We could make the map interactive
          3. we could make an interactive based on live weather data and talk
          4. It is really easy to manually add markers for landmarks/ we could probably           write a function to do this
**Side Note** To work with elevation.

counters 1:5000

MAssGIS for 3 foot intervals but start with 1: 2,5000

CONTOURS250K_ARC for thirty foot intervals. it is smaller and yeet

The date is `r format(Sys.Date(), "%B %e, %Y")`
```{r}
library(tidyverse)
library(dplyr)
library(sf)
library(etl)
library(macleish)
library(leaflet)

devtools::install_github("beanumber/macleish")
```
NEW STUFF
Here is some set up stuff
```{r}
# find intersection point of trails and elevation
elev <- macleish_layers[["contours_3m"]] %>%
  st_transform(4326) 
trails_inbound <- elev %>%
  st_intersection(macleish_layers[["trails"]])
trails_pt<- st_cast(trails_inbound, "POINT")
trails <- macleish_layers[["trails"]] %>%
  group_by(name) %>%
  mutate(length = st_length(geometry)) %>%
  summarize(length_m = sum(length)/1609.34)

#slope
trails_slope <- trails_inbound %>%
  group_by(name) %>%
  mutate(slope = abs(c(NA, diff(ELEV_M))), len = abs(c(NA, diff(SHAPE_LEN)))) %>%
  filter(!is.na(slope)) %>%
  summarize(avg_slope_m = mean(slope/len), tot_change = sum(slope))


#trying to turn back into sf
trails_slope_sf <- trails_slope %>%
  st_as_sf(coords = c("lon", "lat"))
            
trails_temp <- trails_pt %>%
  group_by(name) %>%
  mutate(slope = abs(c(NA, diff(ELEV_M))), len = abs(c(NA, diff(SHAPE_LEN)))) %>%
  filter(!is.na(slope))

df_trails <- as.data.frame(trails_slope) %>%
  select(name, avg_slope_m)%>%
  filter(avg_slope_m>0)
df_trails2 <- as.data.frame(trails_temp)%>%
  select(name, slope, len)%>%
  filter(slope>0)
df <- df_trails %>%
  full_join(df_trails2) %>%
  #WE DECIDED TO HAVE DIFFICULTY BY
  mutate(lvl = ((avg_slope_m)*100)) %>%
  arrange(name)

#trail difficulty classified by average slope
hard <- trails_slope %>%
  filter(avg_slope_m > 20)

moderate <- trails_slope %>%
  filter(avg_slope_m < 20, avg_slope_m > 2)

easy <- trails_slope %>%
  filter(avg_slope_m < 2)

hardsegments <- df %>%
  filter(lvl > 20)

moderatesegments <- df %>%
  filter(lvl < 20, avg_slope_m > 2)

easysegments <- df %>%
  filter(lvl < 2)

#the dataframes of the slope difficulty split up into three different lists
print(easy)
print(moderate)
print(hard)
print(easysegments)
print(moderatesegments)
print(hardsegments)

```
Here are map elements and our final map things
```{r}
# other variables to be mapped
buildings<- macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["buildings"]])
landmarks<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["landmarks"]])
water<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["streams"]])
meepmeep <- colorFactor(topo.colors(9), trails$name, 
                       palette = c('#2b1344','#730be5','#ff2100','#ff907f','#7ffff4', '#f7e165','#777568','#ff0083','#FFBBFF'))

campsite <- tribble(
  ~point, ~lon, ~lat,
  "Group Campsite", -72.678154, 42.450976, 
  "Remote campsite", -72.679581, 42.458549
)
camp_neu <- campsite %>%
  st_as_sf(coords = c("lon", "lat"))


redmarkercustom <- makeIcon(
  iconUrl = "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|e85141&chf=a,s,ee00FFFF",
  iconWidth = 8, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

campsite_marker <- makeIcon(
  iconUrl = "https://upload.wikimedia.org/wikipedia/commons/9/9a/Legenda_pole_namiotowe.svg",
  iconWidth = 10, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

Our_map <- leaflet(data = c( trails_inbound)) %>%
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>% 
  addPolygons(data = macleish_layers[["boundary"]], weight = 3, color = "#01561d", fillOpacity = 0.5)%>%
  addPolylines(data = macleish_layers[["boundary"]], weight = 3, color = "#185b2e", opacity = 0.65) %>%
  addCircleMarkers(data = st_cast(trails_inbound, "POINT"), color = "purple",radius = 2, popup = ~paste("Trail:",name), group = "Trail Segments") %>%
 addPolylines(data = trails, weight = 2, popup = ~name, color = ~meepmeep(trails$name)) %>%# here is where we would start adding our trails by difficulty average. :)
  addPolylines(data = elev, weight = 0.78, color = "#004400")%>%
  addPolygons(data = buildings, color = "202120", stroke = FALSE, fillOpacity = 1, weight = 1, group = "Buildings and Landmarks")%>%
  addMarkers(data = landmarks, 
             popup = ~Label, group = "Buildings and Landmarks", icon = redmarkercustom )%>%
  addMarkers(data = camp_neu, 
             popup = ~point, group = "Buildings and Landmarks", icon = campsite_marker )%>%
  addLayersControl(
    overlayGroups = c( "Buildings and Landmarks", "Trail Segments"), # we will add polylines for the level of difficulty then we can group by category.
    options = layersControlOptions(collapsed = FALSE))


Our_map


```


#difficulty by length and average elevation for difficulty

```
PLEASE DO NOT ERASE CHUNK BELOW SO THAT I CAN PICK UP WHERE I LEFT OFF AND KNOW WHAT I AM THINKING! :D
```{r}
#Delete later. what is in this package
names(macleish_layers)
```
THIS IS ALSO PART OF MY THOUGHT PROCESS> PLEASE DO NOT ERASE
```{r}
trails_inbound%>%
  mutate(computed_length = st_length(geometry))%>%
  group_by(desc(name))

#join by geometry. dataframes but need to covert it into an sf otherwise it will not plot. So make into a data frame and join it and then tyrn it back into spacial data
#cast it to a line string. to get trail
#percent slope and then total length of segments.
#short but steep
# do not actually mutate so that we have the same length 
# then look at coloring the segments
# if weather season looking at slope and winter snow. Looking at where do we clear trees. none of the trails get close enough to a stream maybe in the future with new stream. But not yet. Seein if they can build one towards the beaver trail. Would not be an easy trail under in optimal weather.
#seeps on the hillside. east slope. that makes things muddier = harder
 
```

```{r}

n<- leaflet(data = c( trails_inbound)) %>%
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>% 
  addPolylines(data = trails_temp, weight, group = "trailpractive")


```
