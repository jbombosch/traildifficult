---
title: "It’s Not About the Destination but the Journey"
author: "Juliane Donahue Bombosch, Cai Ytsma, Sofia Salcedo"
date: "15 April 2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
---
Side notes to make creative and more interesting to read amoung the many projects.

It is not about the destination but the journey. MacLeish is a valuable asset for the Smith community. It has approximately four miles of maintained trails accessible to visitors. Insuring accessibilty is important for all levels of hiking experience and helps us curate a fun experience for visitors. We aimed to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. We will utilize spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty.

**Bonus** 1. we could look at weather as a variable and take into account how close trails are to wetland patches etc. So that we can rate difficulty based on weather conditions in the interest of people who need to maintain and use those trails.
          2. We could make the map interactive
          3. we could make an interactive based on live weather data and talk
          4. It is really easy to manually add markers for landmarks/ we could probably           write a function to do this
**Side Note** To work with elevation.

counters 1:5000

MAssGIS for 3 foot intervals but start with 1: 2,5000

CONTOURS250K_ARC for thirty foot intervals. it is smaller and yeet

The date is `r format(Sys.Date(), "%B %e, %Y")`
```{r}
library(tidyverse)
library(dplyr)
library(sf)
library(etl)
library(macleish)
library(leaflet)
proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
devtools::install_github("beanumber/macleish")
```
NEW STUFF
Here is some set up stuff
```{r}
# layer has the same projection 
elev <- macleish_layers[["contours_3m"]] %>%
  st_transform(4326) 
# find intersection point of trails and within Macleish 
trails_inbound <- macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["trails"]])%>%
  st_cast("LINESTRING")
# find intersection point of trails and elevation and then make sure that it is in point not multipoint
trails_elev <- elev %>%
  st_intersection(macleish_layers[["trails"]])
trails_pt<- st_cast(trails_elev, "POINT")

# 1 mile = 1609.34 meters
trails <- macleish_layers[["trails"]] %>%
  mutate(length = st_length(geometry)) %>%
  group_by(name) %>%
  summarize(total_length_mile = sum(length)/1609.34)

#slope
trails_slope <- trails_pt %>%
  group_by(name) %>%
  summarize(num_change = n(),
            min_height = min(ELEV_M),
            max_height = max(ELEV_M)) %>%
  mutate(mean_change = (max_height - min_height)/num_change)

#Cai's slope option
trails_slope_temp <- trails_pt %>%
  group_by(name) %>%
  mutate(slope = abs(c(NA, diff(ELEV_M))), len = abs(c(NA, diff(SHAPE_LEN)))) %>%
  filter(!is.na(slope)) %>%
  summarize(avg_slope_m = mean(slope/len), tot_change = sum(slope))
```
Here are map elements and our final map things
```{r}
buildings<- macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["buildings"]])
landmarks<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["landmarks"]])
water<-  macleish_layers[["boundary"]] %>%
  st_intersection(macleish_layers[["streams"]])
factpal <- colorFactor(topo.colors(9), trails$name, 
                       palette = c('#228B22','#FFFF00','#00FFFF','#FFB90F','#6495ED', '#FF0000','#FF82AB','#836FFF','#FFBBFF'))


campsite <- tribble(
  ~point, ~lon, ~lat,
  "Group Campsite", -72.678154, 42.450976, 
  "Remote campsite", -72.679581, 42.458549
)
camp_neu <- campsite %>%
  st_as_sf(coords = c("lon", "lat"))


redmarkercustom <- makeIcon(
  iconUrl = "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|e85141&chf=a,s,ee00FFFF",
  iconWidth = 8, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

campsite_marker <- makeIcon(
  iconUrl = "https://upload.wikimedia.org/wikipedia/commons/9/9a/Legenda_pole_namiotowe.svg",
  iconWidth = 10, iconHeight = 12,
  iconAnchorX = 10, iconAnchorY = 10
)

Our_map <- leaflet(data = c( trails_inbound)) %>%
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>% 
  addPolygons(data = macleish_layers[["boundary"]], weight = 3, color = "#01561d", fillOpacity = 0.5)%>%
  addPolylines(data = macleish_layers[["boundary"]], weight = 3, color = "#185b2e", opacity = 0.65) %>%
  addPolylines(data = trails, weight = 2, popup = ~name, color = "#4c00ff") %>%
  addPolylines(data = elev, weight = 0.78, color = "#004400")%>%
  addPolygons(data = buildings, color = "202120", stroke = FALSE, fillOpacity = 0.65, weight = 1, popup = ~name, group = "Structures")%>%
  addMarkers(data = landmarks, 
             popup = ~ Label, group = "Structures", icon = redmarkercustom )%>%
  addMarkers(data = camp_neu, 
             popup = ~ point, group = "Structures", icon = campsite_marker )%>%
    addPolygons(data = macleish_layers[["forests"]], 
              color = ~forest_pal(Sheet1__Na), weight = 0.1, 
              fillOpacity = 0.2,
              popup = ~ Sheet1__Na, group = "Natural") %>%
  addPolygons(data = macleish_layers[["wetlands"]], 
              weight = 1, group = "Natural Elements")%>%
    addPolylines(data = water, 
               weight = 2, group = "Natural Elements")%>%
  addLayersControl(
    overlayGroups = c("Boundaries", "Structures", "Natural"), # we will add polylines for the level of difficulty then we can group by category.
    options = layersControlOptions(collapsed = FALSE))


Our_map

#difficulty by length and average elevation for difficulty

```
The following chucnk is an example from lab! Sowy 4 confusion
```{r}
forest_pal <- colorFactor("Greens", macleish_layers[["forests"]]$Sheet1__Na)
bechtel <- data.frame(lat = 42.449167, lon = -72.679389)
m <- leaflet() %>%
  # Base groups
  addTiles(group = "OpenStreetMap") %>%
  addProviderTiles("Esri.WorldTopoMap", group = "Topography") %>%
  addProviderTiles("Esri.WorldImagery", group = "Satellite") %>%
  addProviderTiles("Stamen.TonerLite", group = "Toner Lite") %>%
  # Boundaries
  addPolygons(data = macleish_layers[["boundary"]], weight = 1, fillOpacity = 0.01, group = "Boundaries") %>%
#  addPolygons(data = macleish_layers[["property_boundary"]], weight = 1, fill = "red", fillOpacity = 0.1) %>%
  # Man-Made structures
  addPolygons(data = macleish_layers[["buildings"]], 
              weight = 1, popup = ~ name, group = "Structures") %>%
#  addPolygons(data = macleish_layers[["reservoir"]], 
#              weight = 1, group = "Structures") %>%
  addMarkers(data = macleish_layers[["landmarks"]], 
             popup = ~ Label, group = "Structures") %>%
  addPolylines(data = macleish_layers[["trails"]], 
               weight = 1, color = "brown",
               popup = ~ name, group = "Structures") %>%
  # Natural elements
  addPolygons(data = macleish_layers[["forests"]], 
              color = ~forest_pal(Sheet1__Na), weight = 0.1, 
              fillOpacity = 0.2,
              popup = ~ Sheet1__Na, group = "Natural") %>%
  addPolygons(data = macleish_layers[["wetlands"]], 
              weight = 1, group = "Natural") %>%
  addPolylines(data = macleish_layers[["streams"]], 
               weight = 2, group = "Natural") %>%
  # Layers control
  addLayersControl(
    baseGroups = c("OpenStreetMap", "Topography", "Satellite", "Toner Lite"),
    overlayGroups = c("Boundaries", "Structures", "Natural"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  setView(lat = bechtel$lat, lng = bechtel$lon, zoom = 15)
m

```
PLEASE DO NOT ERASE CHUNK BELOW SO THAT I CAN PICK UP WHERE I LEFT OFF AND KNOW WHAT I AM THINKING! :D
```{r}

#filter or remove multipoints from overlap
#can figure out slope from each intersection. looking at cast

#Delete later. what is in this package
names(macleish_layers)
#things of interest, landmarks, trails, streams

```
THIS IS ALSO PART OF MY THOUGHT PROCESS> PLEASE DO NOT ERASE
```{r}
trails_inbound%>%
  mutate(computed_length = st_length(geometry))%>%
  group_by(desc(name))

# Define the palette for categorical data 
factpal <- colorFactor(topo.colors(9), trails$name, 
                       palette = c('#228B22','#FFFF00','#00FFFF','#FFB90F','#6495ED', '#FF0000','#FF82AB','#836FFF','#FFBBFF'))

#join by geometry. dataframes but need to covert it into an sf otherwise it will not plot. So make into a data frame and join it and then tyrn it back into spacial data
#cast it to a line string. to get trail
#percent slope and then total length of segments.
#short but steep
# do not actually mutate so that we have the same length 
# then look at coloring the segments
# if weather season looking at slope and winter snow. Looking at where do we clear trees. none of the trails get close enough to a stream maybe in the future with new stream. But not yet. Seein if they can build one towards the beaver trail. Would not be an easy trail under in optimal weather.
#seeps on the hillside. east slope. that makes things muddier = harder
 
```
